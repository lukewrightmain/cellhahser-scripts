{
  "id": "script-1764801538474",
  "name": "Unity Force Reload",
  "description": "Unity Sometimes Pushes Hot Fixes, Use this to force close the app and restart",
  "category": "Custom",
  "type": "Python",
  "version": "1.0.0",
  "author": "Cellhasher",
  "tags": [
    "python",
    "unity"
  ],
  "effects": {
    "power": {
      "reboot": false,
      "shutdown": false
    },
    "security": {
      "modifiesLockScreen": false
    }
  },
  "preRunNotice": "This Python script was exported from Cellhasher Script Creator.",
  "pythonScript": "import os\r\nimport time\r\nimport subprocess\r\nfrom concurrent.futures import ThreadPoolExecutor, as_completed\r\n\r\n# Windows console encoding fix\r\nimport sys\r\nif sys.platform == 'win32':\r\n    try:\r\n        import codecs\r\n        sys.stdout.reconfigure(encoding='utf-8', errors='replace')\r\n        sys.stderr.reconfigure(encoding='utf-8', errors='replace')\r\n    except Exception:\r\n        pass  # Continue if reconfigure fails\r\n\r\n# Get environment variables from Cellhasher\r\nADB = os.environ.get(\"adb_path\", \"adb\")\r\ndevices = os.environ.get(\"devices\", \"\").split()\r\n\r\n# Unity app package and activity\r\nUNITY_PACKAGE = \"io.unitynodes.unityapp\"\r\nUNITY_MAIN_ACTIVITY = \"io.unitynodes.unityapp/.MainActivity\"\r\n\r\ndef restart_unity_on_device(device_id):\r\n    \"\"\"\r\n    Restart Unity Node app on a single device\r\n    \"\"\"\r\n    try:\r\n        print(f\"[{device_id}] Restarting Unity Node app...\")\r\n        \r\n        # Step 1: Force stop the app\r\n        print(f\"[{device_id}] Force closing Unity Node...\")\r\n        result = subprocess.run(\r\n            f'\"{ADB}\" -s {device_id} shell am force-stop {UNITY_PACKAGE}',\r\n            shell=True,\r\n            capture_output=True,\r\n            text=True,\r\n            creationflags=subprocess.CREATE_NO_WINDOW if sys.platform == 'win32' else 0\r\n        )\r\n        \r\n        if result.returncode != 0:\r\n            error_msg = result.stderr or result.stdout\r\n            print(f\"[{device_id}] Warning during force-stop: {error_msg}\")\r\n        else:\r\n            print(f\"[{device_id}] Unity Node closed successfully\")\r\n        \r\n        # Step 2: Wait 2 second\r\n        print(f\"[{device_id}] Waiting 2 second...\")\r\n        time.sleep(2)\r\n        \r\n        # Step 3: Start the app\r\n        print(f\"[{device_id}] Opening Unity Node...\")\r\n        result = subprocess.run(\r\n            f'\"{ADB}\" -s {device_id} shell am start -n {UNITY_MAIN_ACTIVITY}',\r\n            shell=True,\r\n            capture_output=True,\r\n            text=True,\r\n            creationflags=subprocess.CREATE_NO_WINDOW if sys.platform == 'win32' else 0\r\n        )\r\n        \r\n        if result.returncode == 0 or \"Starting:\" in result.stdout:\r\n            print(f\"[{device_id}] [OK] Unity Node restarted successfully!\")\r\n            return f\"[{device_id}] Success\"\r\n        else:\r\n            error_msg = result.stderr or result.stdout\r\n            print(f\"[{device_id}] [ERROR] Failed to start app: {error_msg}\")\r\n            return f\"[{device_id}] Failed: {error_msg}\"\r\n    \r\n    except Exception as e:\r\n        print(f\"[{device_id}] [ERROR] Error: {e}\")\r\n        return f\"[{device_id}] Error: {e}\"\r\n\r\ndef main():\r\n    \"\"\"\r\n    Main execution function\r\n    \"\"\"\r\n    print(\"=\" * 60)\r\n    print(\"    Unity Node - Restart App Script\")\r\n    print(\"=\" * 60)\r\n    \r\n    if not devices:\r\n        print(\"[ERROR] No devices found in environment variable 'devices'\")\r\n        print(\"[!] Please select devices in Cellhasher before running this script\")\r\n        return\r\n    \r\n    print(f\"[*] Target devices: {len(devices)}\")\r\n    for idx, device in enumerate(devices, 1):\r\n        print(f\"    {idx}. {device}\")\r\n    print()\r\n    \r\n    try:\r\n        print(\"=\" * 60)\r\n        print(f\"[*] Restarting Unity Node on {len(devices)} device(s) in parallel...\")\r\n        print(\"=\" * 60)\r\n        print()\r\n        \r\n        max_workers = max(1, len(devices))\r\n        with ThreadPoolExecutor(max_workers=max_workers) as executor:\r\n            future_to_device = {\r\n                executor.submit(restart_unity_on_device, device_id): device_id \r\n                for device_id in devices\r\n            }\r\n            \r\n            for future in as_completed(future_to_device):\r\n                device_id = future_to_device[future]\r\n                try:\r\n                    result = future.result()\r\n                    print(result)\r\n                except Exception as exc:\r\n                    print(f\"[{device_id}] Generated an exception: {exc}\")\r\n        \r\n        print()\r\n        print(\"=\" * 60)\r\n        print(\"[OK] Unity Node restart completed on all devices!\")\r\n        print(\"=\" * 60)\r\n    \r\n    except Exception as e:\r\n        print(f\"[ERROR] Script failed: {e}\")\r\n        return\r\n\r\nif __name__ == \"__main__\":\r\n    main()"
}