{
  "id": "script-1766088123822",
  "name": "Minecraft Server Start",
  "description": "Once Minecraft is Deployed/Installed, Use this script to run your server with 1 click.",
  "category": "Custom",
  "type": "Python",
  "version": "1.0.0",
  "author": "Cellhasher Team",
  "tags": [
    "python",
    "exported"
  ],
  "effects": {
    "power": {
      "reboot": false,
      "shutdown": false
    },
    "security": {
      "modifiesLockScreen": false
    }
  },
  "preRunNotice": "This Python script was exported from Cellhasher Script Creator.",
  "pythonScript": "#!/usr/bin/env python3\r\n\"\"\"\r\nMinecraft PaperMC Server - Start Script\r\nOpens Termux and starts the PaperMC server on selected devices\r\nAuthor: Cellhasher Team\r\nVersion: 1.0.0\r\n\"\"\"\r\n\r\nimport os\r\nimport sys\r\nimport time\r\nimport subprocess\r\nfrom concurrent.futures import ThreadPoolExecutor, as_completed\r\n\r\n# Windows console encoding fix\r\nif sys.platform == 'win32':\r\n    try:\r\n        sys.stdout.reconfigure(encoding='utf-8', errors='replace')\r\n        sys.stderr.reconfigure(encoding='utf-8', errors='replace')\r\n    except Exception:\r\n        pass\r\n\r\n# Script metadata for Cellhasher integration\r\nSCRIPT_META = {\r\n    \"id\": \"minecraft-start-server-v1\",\r\n    \"name\": \"Minecraft Server - Start\",\r\n    \"description\": \"Starts the PaperMC Minecraft server on selected devices. Shows device IP and server port.\",\r\n    \"category\": \"Gaming\",\r\n    \"type\": \"python\",\r\n    \"version\": \"1.0.0\",\r\n    \"author\": \"Cellhasher Team\",\r\n    \"difficulty\": \"Easy\",\r\n    \"estimatedTime\": \"30 sec\",\r\n    \"tags\": [\"minecraft\", \"server\", \"papermc\", \"gaming\", \"termux\", \"start\"],\r\n    \"effects\": {\r\n        \"power\": {\"reboot\": False, \"shutdown\": False},\r\n        \"security\": {\"modifiesLockScreen\": False}\r\n    },\r\n    \"estimatedDurationSec\": 30,\r\n    \"downloads\": 0,\r\n    \"rating\": 5.0,\r\n    \"lastUpdated\": \"today\"\r\n}\r\n\r\n# Get environment variables from Cellhasher\r\nADB = os.environ.get(\"adb_path\", \"adb\")\r\ndevices = os.environ.get(\"devices\", \"\").split()\r\n\r\n\r\ndef get_device_ip(device_id):\r\n    \"\"\"Get the WiFi IP address of the device\"\"\"\r\n    try:\r\n        # Try wlan0 first (most common for WiFi)\r\n        result = subprocess.run(\r\n            f'\"{ADB}\" -s {device_id} shell ip addr show wlan0 2>/dev/null | grep \"inet \" | awk \\'{{print $2}}\\' | cut -d/ -f1',\r\n            shell=True,\r\n            capture_output=True,\r\n            text=True,\r\n            creationflags=subprocess.CREATE_NO_WINDOW if sys.platform == 'win32' else 0\r\n        )\r\n        ip = result.stdout.strip()\r\n        if ip:\r\n            return ip\r\n        \r\n        # Fallback: try to get any non-loopback IP\r\n        result = subprocess.run(\r\n            f'\"{ADB}\" -s {device_id} shell ip route | grep -oP \"src \\\\K[0-9.]+\"',\r\n            shell=True,\r\n            capture_output=True,\r\n            text=True,\r\n            creationflags=subprocess.CREATE_NO_WINDOW if sys.platform == 'win32' else 0\r\n        )\r\n        ip = result.stdout.strip().split('\\n')[0] if result.stdout.strip() else None\r\n        if ip:\r\n            return ip\r\n            \r\n        # Last resort: ifconfig style\r\n        result = subprocess.run(\r\n            f'\"{ADB}\" -s {device_id} shell ifconfig wlan0 2>/dev/null | grep \"inet addr\"',\r\n            shell=True,\r\n            capture_output=True,\r\n            text=True,\r\n            creationflags=subprocess.CREATE_NO_WINDOW if sys.platform == 'win32' else 0\r\n        )\r\n        if \"inet addr:\" in result.stdout:\r\n            ip = result.stdout.split(\"inet addr:\")[1].split()[0]\r\n            return ip\r\n            \r\n        return \"Unknown\"\r\n    except Exception as e:\r\n        return f\"Error: {e}\"\r\n\r\n\r\ndef start_minecraft_server(device_id):\r\n    \"\"\"Start the Minecraft server on a device\"\"\"\r\n    try:\r\n        # Step 1: Get device IP FIRST so user knows where to connect\r\n        print(f\"[{device_id}] Getting device IP address...\")\r\n        device_ip = get_device_ip(device_id)\r\n        \r\n        # Display connection info prominently BEFORE starting\r\n        print()\r\n        print(f\"[{device_id}] ========================================\")\r\n        print(f\"[{device_id}]   MINECRAFT SERVER CONNECTION INFO\")\r\n        print(f\"[{device_id}] ========================================\")\r\n        print(f\"[{device_id}]   IP Address: {device_ip}\")\r\n        print(f\"[{device_id}]   Port: 25565\")\r\n        print(f\"[{device_id}]   Connect to: {device_ip}:25565\")\r\n        print(f\"[{device_id}] ========================================\")\r\n        print()\r\n        print(f\"[{device_id}] Starting server now...\")\r\n        \r\n        # Step 2: Force stop Termux if running\r\n        print(f\"[{device_id}] Stopping any existing Termux session...\")\r\n        subprocess.run(\r\n            f'\"{ADB}\" -s {device_id} shell am force-stop com.termux',\r\n            shell=True,\r\n            capture_output=True,\r\n            creationflags=subprocess.CREATE_NO_WINDOW if sys.platform == 'win32' else 0\r\n        )\r\n        time.sleep(1)\r\n        \r\n        # Step 3: Launch Termux\r\n        print(f\"[{device_id}] Launching Termux...\")\r\n        subprocess.run(\r\n            f'\"{ADB}\" -s {device_id} shell am start -n com.termux/com.termux.app.TermuxActivity',\r\n            shell=True,\r\n            capture_output=True,\r\n            creationflags=subprocess.CREATE_NO_WINDOW if sys.platform == 'win32' else 0\r\n        )\r\n        \r\n        # Step 4: Wait for Termux to initialize\r\n        print(f\"[{device_id}] Waiting for Termux to initialize (10 seconds)...\")\r\n        time.sleep(10)\r\n        \r\n        # Step 5: Type cd command first\r\n        print(f\"[{device_id}] Changing to minecraft directory...\")\r\n        cd_cmd = \"cd%s~/mc\"\r\n        subprocess.run(\r\n            f'\"{ADB}\" -s {device_id} shell input text \"{cd_cmd}\"',\r\n            shell=True,\r\n            capture_output=True,\r\n            creationflags=subprocess.CREATE_NO_WINDOW if sys.platform == 'win32' else 0\r\n        )\r\n        time.sleep(0.3)\r\n        \r\n        # Press Enter\r\n        subprocess.run(\r\n            f'\"{ADB}\" -s {device_id} shell input keyevent 66',\r\n            shell=True,\r\n            capture_output=True,\r\n            creationflags=subprocess.CREATE_NO_WINDOW if sys.platform == 'win32' else 0\r\n        )\r\n        time.sleep(1)\r\n        \r\n        # Step 6: Type the java start command\r\n        # java -Xms512M -Xmx1024M -jar paper.jar nogui\r\n        print(f\"[{device_id}] Sending server start command...\")\r\n        java_cmd = \"java%s-Xms512M%s-Xmx1024M%s-jar%spaper.jar%snogui\"\r\n        subprocess.run(\r\n            f'\"{ADB}\" -s {device_id} shell input text \"{java_cmd}\"',\r\n            shell=True,\r\n            capture_output=True,\r\n            creationflags=subprocess.CREATE_NO_WINDOW if sys.platform == 'win32' else 0\r\n        )\r\n        time.sleep(0.3)\r\n        \r\n        # Step 7: Press Enter to execute\r\n        subprocess.run(\r\n            f'\"{ADB}\" -s {device_id} shell input keyevent 66',\r\n            shell=True,\r\n            capture_output=True,\r\n            creationflags=subprocess.CREATE_NO_WINDOW if sys.platform == 'win32' else 0\r\n        )\r\n        \r\n        print(f\"[{device_id}] [OK] Server start command sent!\")\r\n        print()\r\n        \r\n        return {\r\n            \"device\": device_id,\r\n            \"ip\": device_ip,\r\n            \"port\": 25565,\r\n            \"status\": \"Success\"\r\n        }\r\n        \r\n    except Exception as e:\r\n        print(f\"[{device_id}] [ERROR] {e}\")\r\n        return {\r\n            \"device\": device_id,\r\n            \"ip\": \"Unknown\",\r\n            \"port\": 25565,\r\n            \"status\": f\"Error: {e}\"\r\n        }\r\n\r\n\r\ndef main():\r\n    \"\"\"Main execution function\"\"\"\r\n    print(\"=\" * 60)\r\n    print(\"   Minecraft PaperMC Server - Start\")\r\n    print(\"=\" * 60)\r\n    print()\r\n    \r\n    if not devices:\r\n        print(\"[ERROR] No devices found in environment variable 'devices'\")\r\n        print(\"[!] Please select devices in Cellhasher before running this script\")\r\n        return\r\n    \r\n    print(f\"[*] Target devices: {len(devices)}\")\r\n    for idx, device in enumerate(devices, 1):\r\n        print(f\"    {idx}. {device}\")\r\n    print()\r\n    \r\n    # Start servers on all devices in parallel\r\n    print(\"=\" * 60)\r\n    print(f\"[*] Starting Minecraft servers on {len(devices)} device(s)...\")\r\n    print(\"=\" * 60)\r\n    print()\r\n    \r\n    max_workers = max(1, len(devices))\r\n    results = []\r\n    \r\n    with ThreadPoolExecutor(max_workers=max_workers) as executor:\r\n        future_to_device = {\r\n            executor.submit(start_minecraft_server, device_id): device_id\r\n            for device_id in devices\r\n        }\r\n        \r\n        for future in as_completed(future_to_device):\r\n            device_id = future_to_device[future]\r\n            try:\r\n                result = future.result()\r\n                results.append(result)\r\n            except Exception as exc:\r\n                print(f\"[{device_id}] Generated an exception: {exc}\")\r\n    \r\n    # Summary\r\n    print()\r\n    print(\"=\" * 60)\r\n    print(\"   Server Connection Details\")\r\n    print(\"=\" * 60)\r\n    print()\r\n    \r\n    successful = [r for r in results if r[\"status\"] == \"Success\"]\r\n    \r\n    if successful:\r\n        print(\"Connect to your Minecraft servers using:\")\r\n        print()\r\n        for result in successful:\r\n            print(f\"  [{result['device']}]\")\r\n            print(f\"    Address: {result['ip']}:25565\")\r\n            print()\r\n    \r\n    print(f\"[*] Servers started: {len(successful)}/{len(devices)}\")\r\n    print()\r\n    print(\"[TIP] Server may take 30-60 seconds to fully start\")\r\n    print(\"[TIP] Watch Termux on the device for 'Done!' message\")\r\n    print(\"=\" * 60)\r\n\r\n\r\nif __name__ == \"__main__\":\r\n    main()"
}
