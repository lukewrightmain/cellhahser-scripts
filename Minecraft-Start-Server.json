{
  "id": "script-1766088614382",
  "name": "Minecraft Server Start",
  "description": "Once your Minecraft Server is Installed, Use this to Start your server",
  "category": "Custom",
  "type": "Python",
  "version": "1.0.0",
  "author": "Cellhasher User",
  "tags": [
    "python",
    "exported"
  ],
  "effects": {
    "power": {
      "reboot": false,
      "shutdown": false
    },
    "security": {
      "modifiesLockScreen": false
    }
  },
  "preRunNotice": "This Python script was exported from Cellhasher Script Creator.",
  "pythonScript": "#!/usr/bin/env python3\r\n\"\"\"\r\nMinecraft PaperMC Server - Start Script\r\nPushes a start script to Termux with RAM selection and IP display\r\nAuthor: Cellhasher Team\r\nVersion: 2.0.0\r\n\"\"\"\r\n\r\nimport os\r\nimport sys\r\nimport time\r\nimport subprocess\r\nimport tempfile\r\nfrom concurrent.futures import ThreadPoolExecutor, as_completed\r\n\r\n# Windows console encoding fix\r\nif sys.platform == 'win32':\r\n    try:\r\n        sys.stdout.reconfigure(encoding='utf-8', errors='replace')\r\n        sys.stderr.reconfigure(encoding='utf-8', errors='replace')\r\n    except Exception:\r\n        pass\r\n\r\n# Script metadata for Cellhasher integration\r\nSCRIPT_META = {\r\n    \"id\": \"minecraft-start-server-v2\",\r\n    \"name\": \"Minecraft Server - Start\",\r\n    \"description\": \"Starts the PaperMC Minecraft server with RAM selection. Shows device IP and lets you choose memory allocation.\",\r\n    \"category\": \"Gaming\",\r\n    \"type\": \"python\",\r\n    \"version\": \"2.0.0\",\r\n    \"author\": \"Cellhasher Team\",\r\n    \"difficulty\": \"Easy\",\r\n    \"estimatedTime\": \"30 sec\",\r\n    \"tags\": [\"minecraft\", \"server\", \"papermc\", \"gaming\", \"termux\", \"start\"],\r\n    \"effects\": {\r\n        \"power\": {\"reboot\": False, \"shutdown\": False},\r\n        \"security\": {\"modifiesLockScreen\": False}\r\n    },\r\n    \"estimatedDurationSec\": 30,\r\n    \"downloads\": 0,\r\n    \"rating\": 5.0,\r\n    \"lastUpdated\": \"today\"\r\n}\r\n\r\n# Get environment variables from Cellhasher\r\nADB = os.environ.get(\"adb_path\", \"adb\")\r\ndevices = os.environ.get(\"devices\", \"\").split()\r\n\r\n# Bash script that runs inside Termux\r\n# Shows IP, asks for RAM, starts server\r\nTERMUX_START_SCRIPT = r'''#!/data/data/com.termux/files/usr/bin/bash\r\n\r\n# Colors for pretty output\r\nRED='\\033[0;31m'\r\nGREEN='\\033[0;32m'\r\nYELLOW='\\033[1;33m'\r\nBLUE='\\033[0;34m'\r\nCYAN='\\033[0;36m'\r\nWHITE='\\033[1;37m'\r\nNC='\\033[0m' # No Color\r\n\r\nclear\r\n\r\necho \"\"\r\necho -e \"${CYAN}╔════════════════════════════════════════════════════════════╗${NC}\"\r\necho -e \"${CYAN}║${WHITE}        MINECRAFT PAPERMC SERVER - START MENU             ${CYAN}║${NC}\"\r\necho -e \"${CYAN}╚════════════════════════════════════════════════════════════╝${NC}\"\r\necho \"\"\r\n\r\n# Get device IP address\r\nDEVICE_IP=$(ip addr show wlan0 2>/dev/null | grep 'inet ' | awk '{print $2}' | cut -d/ -f1)\r\nif [ -z \"$DEVICE_IP\" ]; then\r\n    DEVICE_IP=$(ip route 2>/dev/null | grep 'src' | awk '{print $NF}' | head -1)\r\nfi\r\nif [ -z \"$DEVICE_IP\" ]; then\r\n    DEVICE_IP=\"Unknown\"\r\nfi\r\n\r\n# Display connection info\r\necho -e \"${GREEN}╔════════════════════════════════════════════════════════════╗${NC}\"\r\necho -e \"${GREEN}║${WHITE}              SERVER CONNECTION DETAILS                    ${GREEN}║${NC}\"\r\necho -e \"${GREEN}╠════════════════════════════════════════════════════════════╣${NC}\"\r\necho -e \"${GREEN}║${NC}  IP Address:  ${YELLOW}${DEVICE_IP}${NC}\"\r\necho -e \"${GREEN}║${NC}  Port:        ${YELLOW}25565${NC}\"\r\necho -e \"${GREEN}║${NC}  Connect to:  ${CYAN}${DEVICE_IP}:25565${NC}\"\r\necho -e \"${GREEN}╚════════════════════════════════════════════════════════════╝${NC}\"\r\necho \"\"\r\n\r\n# Check if server directory exists\r\nif [ ! -d ~/mc ]; then\r\n    echo -e \"${RED}[ERROR] Server directory ~/mc not found!${NC}\"\r\n    echo -e \"${YELLOW}Please run the PaperMC installer first.${NC}\"\r\n    exit 1\r\nfi\r\n\r\nif [ ! -f ~/mc/paper.jar ]; then\r\n    echo -e \"${RED}[ERROR] paper.jar not found in ~/mc!${NC}\"\r\n    echo -e \"${YELLOW}Please run the PaperMC installer first.${NC}\"\r\n    exit 1\r\nfi\r\n\r\n# RAM Selection\r\necho -e \"${BLUE}╔════════════════════════════════════════════════════════════╗${NC}\"\r\necho -e \"${BLUE}║${WHITE}                  RAM ALLOCATION                           ${BLUE}║${NC}\"\r\necho -e \"${BLUE}╠════════════════════════════════════════════════════════════╣${NC}\"\r\necho -e \"${BLUE}║${NC}  How much RAM to allocate to the server?                   ${BLUE}║${NC}\"\r\necho -e \"${BLUE}║${NC}                                                            ${BLUE}║${NC}\"\r\necho -e \"${BLUE}║${NC}  Enter a number in GB (e.g., 1, 2, 3)                      ${BLUE}║${NC}\"\r\necho -e \"${BLUE}║${NC}  Or press ${GREEN}ENTER${NC} for default (1 GB)                        ${BLUE}║${NC}\"\r\necho -e \"${BLUE}╚════════════════════════════════════════════════════════════╝${NC}\"\r\necho \"\"\r\necho -ne \"${WHITE}RAM (GB) [1]: ${NC}\"\r\nread -r RAM_INPUT\r\n\r\n# Default to 1 GB if empty\r\nif [ -z \"$RAM_INPUT\" ]; then\r\n    RAM_GB=1\r\nelse\r\n    # Validate input is a number\r\n    if [[ \"$RAM_INPUT\" =~ ^[0-9]+$ ]]; then\r\n        RAM_GB=$RAM_INPUT\r\n    else\r\n        echo -e \"${YELLOW}Invalid input, using default (1 GB)${NC}\"\r\n        RAM_GB=1\r\n    fi\r\nfi\r\n\r\n# Convert GB to MB\r\nRAM_MB=$((RAM_GB * 1024))\r\n\r\n# Calculate min RAM (half of max, minimum 512MB)\r\nMIN_RAM_MB=$((RAM_MB / 2))\r\nif [ $MIN_RAM_MB -lt 512 ]; then\r\n    MIN_RAM_MB=512\r\nfi\r\n\r\necho \"\"\r\necho -e \"${GREEN}╔════════════════════════════════════════════════════════════╗${NC}\"\r\necho -e \"${GREEN}║${WHITE}                 STARTING SERVER                           ${GREEN}║${NC}\"\r\necho -e \"${GREEN}╠════════════════════════════════════════════════════════════╣${NC}\"\r\necho -e \"${GREEN}║${NC}  Memory:      ${YELLOW}-Xms${MIN_RAM_MB}M -Xmx${RAM_MB}M${NC}\"\r\necho -e \"${GREEN}║${NC}  Directory:   ${YELLOW}~/mc${NC}\"\r\necho -e \"${GREEN}║${NC}  Server:      ${YELLOW}paper.jar${NC}\"\r\necho -e \"${GREEN}╚════════════════════════════════════════════════════════════╝${NC}\"\r\necho \"\"\r\necho -e \"${CYAN}Starting Minecraft server in 3 seconds...${NC}\"\r\nsleep 1\r\necho -e \"${CYAN}Starting in 2...${NC}\"\r\nsleep 1\r\necho -e \"${CYAN}Starting in 1...${NC}\"\r\nsleep 1\r\necho \"\"\r\necho -e \"${GREEN}[SERVER] Launching PaperMC...${NC}\"\r\necho \"============================================================\"\r\necho \"\"\r\n\r\n# Change to server directory and start\r\ncd ~/mc\r\njava -Xms${MIN_RAM_MB}M -Xmx${RAM_MB}M -jar paper.jar nogui\r\n'''\r\n\r\n\r\ndef start_minecraft_server(device_id, script_path):\r\n    \"\"\"Start the Minecraft server on a device\"\"\"\r\n    try:\r\n        print(f\"[{device_id}] Preparing to start Minecraft server...\")\r\n        \r\n        # Step 1: Force stop Termux if running\r\n        print(f\"[{device_id}] Stopping any existing Termux session...\")\r\n        subprocess.run(\r\n            [ADB, \"-s\", device_id, \"shell\", \"am\", \"force-stop\", \"com.termux\"],\r\n            capture_output=True,\r\n            creationflags=subprocess.CREATE_NO_WINDOW if sys.platform == 'win32' else 0\r\n        )\r\n        time.sleep(1)\r\n        \r\n        # Step 2: Push the start script to device\r\n        device_temp_path = \"/data/local/tmp/mc_start.sh\"\r\n        print(f\"[{device_id}] Pushing start script...\")\r\n        \r\n        result = subprocess.run(\r\n            [ADB, \"-s\", device_id, \"push\", script_path, device_temp_path],\r\n            capture_output=True,\r\n            text=True,\r\n            creationflags=subprocess.CREATE_NO_WINDOW if sys.platform == 'win32' else 0\r\n        )\r\n        \r\n        if result.returncode != 0:\r\n            print(f\"[{device_id}] [ERROR] Failed to push script: {result.stderr}\")\r\n            return f\"[{device_id}] Error: Failed to push script\"\r\n        \r\n        # Step 3: Make script executable\r\n        print(f\"[{device_id}] Setting script permissions...\")\r\n        subprocess.run(\r\n            [ADB, \"-s\", device_id, \"shell\", \"chmod\", \"755\", device_temp_path],\r\n            capture_output=True,\r\n            creationflags=subprocess.CREATE_NO_WINDOW if sys.platform == 'win32' else 0\r\n        )\r\n        \r\n        # Step 4: Launch Termux\r\n        print(f\"[{device_id}] Launching Termux...\")\r\n        subprocess.run(\r\n            [ADB, \"-s\", device_id, \"shell\", \"am\", \"start\", \"-n\", \"com.termux/com.termux.app.TermuxActivity\"],\r\n            capture_output=True,\r\n            creationflags=subprocess.CREATE_NO_WINDOW if sys.platform == 'win32' else 0\r\n        )\r\n        \r\n        # Step 5: Wait for Termux to initialize\r\n        print(f\"[{device_id}] Waiting for Termux to initialize (10 seconds)...\")\r\n        time.sleep(10)\r\n        \r\n        # Step 6: Type the command to run our script\r\n        run_cmd = \"bash%s/data/local/tmp/mc_start.sh\"\r\n        print(f\"[{device_id}] Running start script...\")\r\n        \r\n        subprocess.run(\r\n            [ADB, \"-s\", device_id, \"shell\", \"input\", \"text\", run_cmd],\r\n            capture_output=True,\r\n            creationflags=subprocess.CREATE_NO_WINDOW if sys.platform == 'win32' else 0\r\n        )\r\n        time.sleep(0.3)\r\n        \r\n        # Step 7: Press Enter to execute\r\n        subprocess.run(\r\n            [ADB, \"-s\", device_id, \"shell\", \"input\", \"keyevent\", \"66\"],\r\n            capture_output=True,\r\n            creationflags=subprocess.CREATE_NO_WINDOW if sys.platform == 'win32' else 0\r\n        )\r\n        \r\n        print(f\"[{device_id}] [OK] Start script launched!\")\r\n        print(f\"[{device_id}] The device will show connection info and ask for RAM allocation.\")\r\n        print(f\"[{device_id}] Press ENTER on device for default (1GB) or type a number (e.g., 2 for 2GB)\")\r\n        \r\n        return f\"[{device_id}] Success - Start menu launched on device\"\r\n        \r\n    except Exception as e:\r\n        print(f\"[{device_id}] [ERROR] {e}\")\r\n        return f\"[{device_id}] Error: {e}\"\r\n\r\n\r\ndef main():\r\n    \"\"\"Main execution function\"\"\"\r\n    print(\"=\" * 60)\r\n    print(\"   Minecraft PaperMC Server - Start\")\r\n    print(\"   Interactive RAM selection on device\")\r\n    print(\"=\" * 60)\r\n    print()\r\n    \r\n    if not devices:\r\n        print(\"[ERROR] No devices found in environment variable 'devices'\")\r\n        print(\"[!] Please select devices in Cellhasher before running this script\")\r\n        return\r\n    \r\n    print(f\"[*] Target devices: {len(devices)}\")\r\n    for idx, device in enumerate(devices, 1):\r\n        print(f\"    {idx}. {device}\")\r\n    print()\r\n    \r\n    # Create temporary script file\r\n    print(\"[*] Creating start script...\")\r\n    with tempfile.NamedTemporaryFile(\r\n        mode='w', \r\n        encoding='utf-8', \r\n        newline='\\n', \r\n        delete=False, \r\n        suffix='.sh'\r\n    ) as f:\r\n        f.write(TERMUX_START_SCRIPT)\r\n        local_script_path = f.name\r\n    print(f\"[OK] Script saved to: {local_script_path}\")\r\n    print()\r\n    \r\n    # Start on all devices\r\n    print(\"=\" * 60)\r\n    print(f\"[*] Launching start menu on {len(devices)} device(s)...\")\r\n    print(\"=\" * 60)\r\n    print()\r\n    \r\n    max_workers = max(1, len(devices))\r\n    results = []\r\n    \r\n    with ThreadPoolExecutor(max_workers=max_workers) as executor:\r\n        future_to_device = {\r\n            executor.submit(start_minecraft_server, device_id, local_script_path): device_id\r\n            for device_id in devices\r\n        }\r\n        \r\n        for future in as_completed(future_to_device):\r\n            device_id = future_to_device[future]\r\n            try:\r\n                result = future.result()\r\n                results.append(result)\r\n                print(result)\r\n            except Exception as exc:\r\n                print(f\"[{device_id}] Generated an exception: {exc}\")\r\n    \r\n    # Cleanup\r\n    print()\r\n    print(\"[*] Cleaning up temporary files...\")\r\n    if os.path.exists(local_script_path):\r\n        os.unlink(local_script_path)\r\n        print(\"[OK] Removed temporary script file\")\r\n    \r\n    # Summary\r\n    print()\r\n    print(\"=\" * 60)\r\n    print(\"   What to do next:\")\r\n    print(\"=\" * 60)\r\n    print()\r\n    print(\"   On each device, the start menu is now displayed showing:\")\r\n    print(\"   - Server IP address and port\")\r\n    print(\"   - RAM allocation prompt\")\r\n    print()\r\n    print(\"   Press ENTER on device for default (1GB RAM)\")\r\n    print(\"   Or type a number (e.g., 2 for 2GB, 3 for 3GB)\")\r\n    print()\r\n    print(\"   The server will start after you confirm RAM selection!\")\r\n    print(\"=\" * 60)\r\n\r\n\r\nif __name__ == \"__main__\":\r\n    main()"
}
